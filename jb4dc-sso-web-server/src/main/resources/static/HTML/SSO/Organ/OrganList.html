<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><title>JBuild4D</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><script type="text/javascript" src="../../../Js/External/JQuery-3.4.1/jquery-3.4.1.min.js"></script><script type="text/javascript" src="../../../Js/External/VUE-2.6.10/vue.js"></script><script type="text/javascript" src="../../../Js/External/IView-3.X/dist/iview.min.js"></script><script type="text/javascript" src="../../../Js/External/JQuery-UI-1.12.1/jquery-ui.js"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/jquery.ztree.all.js"></script><script type="text/javascript" src="../../../Js/JBuild4DCLib.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/UIEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/VueEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/SSOVueEXComponent.js?refVersion=1"></script><link rel="stylesheet" type="text/css" href="../../../Themes/Default/Css/JBuild4DC.css?refVersion=1"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/IView-3.X/iview.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/JQueryUI/jquery-ui.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/JQueryUI/jquery-ui-important.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/ZTree/zTreeStyle/zTreeStyle.css"><script type="text/javascript" src="../../../Js/External/Go-2.0.3/go-debug.js"></script><script type="text/javascript" src="../../../Js/External/Go-2.0.3/Figures.js"></script><style>.ivu-tabs-nav-scroll{float:right}</style></head><body><div id="appList"><tabs type="card"><tab-pane label="组织机构信息1"><div class="iv-list-page-wrap"><div class="list-button-outer-wrap" id="list-button-wrap"><div class="list-button-inner-wrap" style="margin-bottom:10px"><button-group><i-button type="success" @click="add()" icon="md-add">新增</i-button><i-button type="primary" @click="edit()" icon="md-create">修改</i-button><i-button type="primary" @click="del()" icon="md-close">删除</i-button><i-button type="primary" @click="view()" icon="md-search">浏览</i-button><i-button type="primary" @click="statusEnable('启用')" icon="md-checkmark-circle">启用</i-button><i-button type="primary" @click="statusEnable('禁用')" icon="md-close-circle">禁用</i-button><i-button type="primary" @click="move('up')" icon="md-arrow-up">上移</i-button><i-button type="primary" @click="move('down')" icon="md-arrow-down">下移</i-button></button-group></div><div style="clear:both"></div></div><div id="divTreeTable" style="width:100%;margin:auto;overflow:auto"></div></div></tab-pane><tab-pane label="组织机构图"><div><div id="sample" style="position:relative"><div id="myDiagramDiv" style="background-color:#fff;border:solid 1px #000;width:100%;height:700px"></div><div id="myOverviewDiv"></div><input type="search" id="mySearch" onkeypress="13===event.keyCode&&searchDiagram()"> <button onclick="searchDiagram()">Search</button></div><input id="xxo_photo" type="hidden" value=""><input id="hdminWidthValue" type="hidden" value="10"><input id="hdminHeightValue" type="hidden" value="10"></div></tab-pane></tabs></div><script>var treeTableObj=null,appList=new Vue({el:"#appList",mounted:function(){this.reloadTreeTableData(),window.setTimeout(function(){$("#divTreeTable").css("height",ListPageUtility.GetGeneralPageHeight(-20))},500)},data:{acInterface:{editView:"/HTML/SSO/Organ/OrganEdit.html",reloadData:"/Rest/SSO/Org/Organ/GetListData",delete:"/Rest/SSO/Org/Organ/Delete",statusChange:"/Rest/SSO/Org/Organ/StatusChange",move:"/Rest/SSO/Org/Organ/Move"},treeTableObject:null,treeTableConfig:{CanDeleteWhenHasChild:!1,IdField:"organId",RowIdPrefix:"TreeTable_",LoadChildJsonURL:"",LoadChildFunc:null,OpenLevel:1,ChildTestField:"organChildCount",Templates:[{Title:"组织名称",FieldName:"organName",TitleCellClassName:"TitleCell",Hidden:!1,TitleCellAttrs:{},Width:"40"},{Title:"简称",FieldName:"organShortName",TitleCellClassName:"TitleCell",Hidden:!1,TitleCellAttrs:{},Width:"40",TextAlign:"center"},{Title:"创建时间",FieldName:"organCreateTime",TitleCellClassName:"TitleCell",Renderer:"DateTime",Hidden:!1,TitleCellAttrs:{},Width:"40",TextAlign:"center"},{Title:"状态",FieldName:"organStatus",TitleCellClassName:"TitleCell",Hidden:!1,TitleCellAttrs:{},Width:"10%",TextAlign:"center"}],TableClass:"TreeTable",RendererTo:"divTreeTable",TableId:"TreeTable",TableAttrs:{cellpadding:"0",cellspacing:"0",border:"0"}}},methods:{reloadTreeTableData:function(){AjaxUtility.Post(this.acInterface.reloadData,{pageSize:2e3,pageNum:1},function(e){if(e.success){null==e.data&&(e.data=new Array);var t=JsonUtility.ParseArrayJsonToTreeJson({KeyField:"organId",RelationField:"organParentId",ChildFieldName:"Nodes"},e.data.list,"0");$("#divTreeTable").html(""),this.treeTableObject=Object.create(TreeTable),this.treeTableObject.Initialization(this.treeTableConfig),this.treeTableObject.LoadJsonData(t)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)},mareSureSelectedTreeTableRow:function(e){var t=this.treeTableObject.GetSelectedRowData();return null==t?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要"+e+"的节点!",null),{then:function(e){}}):"0"==t[appList.treeTableConfig.IdField]?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"不能编辑根节点!",null),{then:function(e){}}):{then:function(e){e.call(appList,t)}}},add:function(){if(null!=this.treeTableObject){var e=this.treeTableObject.GetSelectedRowData();if(null==e)return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择上级组织!",null),!1;var t=BaseUtility.BuildView(this.acInterface.editView,{parentId:e[this.treeTableConfig.IdField],op:"add"});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"组织管理"},1)}},edit:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildView(this.acInterface.editView,{op:"update",recordId:e[this.treeTableConfig.IdField]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"组织管理"},1)})},del:function(){this.mareSureSelectedTreeTableRow("删除").then(function(e){var t=e[this.treeTableConfig.IdField],i=this;DialogUtility.Confirm(window,"确认要删除选定的节点吗？",function(){AjaxUtility.Delete(i.acInterface.delete,{recordId:t},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){this.treeTableObject.DeleteRow(t)},this):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)},this)})},view:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildView(this.acInterface.editView,{op:"view",recordId:e[this.treeTableConfig.IdField]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"组织管理"},1)})},statusEnable:function(i){this.mareSureSelectedTreeTableRow("启用").then(function(t){var e=t[appList.treeTableConfig.IdField];AjaxUtility.Post(this.acInterface.statusChange,{ids:e,status:i},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){t.organStatus=i,this.treeTableObject.UpdateToRow(t[appList.treeTableConfig.IdField],t)},this):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)})},move:function(i){this.mareSureSelectedTreeTableRow("选中").then(function(t){var e=t[appList.treeTableConfig.IdField];AjaxUtility.Post(this.acInterface.move,{recordId:e,type:i},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){"down"==i?this.treeTableObject.MoveDownRow(t[appList.treeTableConfig.IdField]):this.treeTableObject.MoveUpRow(t[appList.treeTableConfig.IdField])},this):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)})},newTreeTableNode:function(e){this.treeTableObject.AppendChildRowToCurrentSelectedRow(e)},updateTreeTableNode:function(e){this.treeTableObject.UpdateToRow(e[appList.treeTableConfig.IdField],e)},reloadOrganData:function(t){AjaxUtility.Post(this.acInterface.reloadData,{pageSize:2e3,pageNum:1},function(e){e.success?t(e):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)}}})</script><script>function init(e){console.log(e),window.goSamples&&goSamples();var t=go.GraphObject.make;myDiagram=t(go.Diagram,"myDiagramDiv",{initialDocumentSpot:go.Spot.TopCenter,initialViewportSpot:go.Spot.TopCenter,layout:t(go.TreeLayout,{treeStyle:go.TreeLayout.StyleLastParents,angle:90,layerSpacing:80,alternateAngle:0,alternateAlignment:go.TreeLayout.AlignmentStart,alternateNodeIndent:20,alternateNodeIndentPastParent:1,alternateNodeSpacing:20,alternateLayerSpacing:40,alternateLayerSpacingParentOverlap:1,alternatePortSpot:new go.Spot(.001,1,20,0),alternateChildPortSpot:go.Spot.Left})}),myDiagram.nodeTemplate=t(go.Node,"Auto",t(go.Shape,"Rectangle",{stroke:null,strokeWidth:0},new go.Binding("fill","isHighlighted",function(e){return e?"#F44336":"#A7E7FC"}).ofObject()),t(go.Panel,"Table",{margin:6,maxSize:new go.Size(200,NaN)},t(go.RowColumnDefinition,{column:0,stretch:go.GraphObject.Horizontal,alignment:go.Spot.Left}),t(go.TextBlock,{row:0,column:0,maxSize:new go.Size(160,NaN),margin:2,font:"500 16px Roboto, sans-serif",alignment:go.Spot.Top},new go.Binding("text","name")),t(go.Picture,{row:0,column:1,margin:2,imageStretch:go.GraphObject.Uniform,alignment:go.Spot.TopRight},new go.Binding("desiredSize","nation",function(){return new go.Size(34,26)}),new go.Binding("source","nation",function(e){return"https://www.nwoods.com/go/Flags/"+e.toLowerCase().replace(/\s/g,"-")+"-flag.Png"})),t(go.TextBlock,{row:1,column:0,columnSpan:2,font:"12px Roboto, sans-serif"},new go.Binding("text","",function(e){var t="";if(e.title&&(t+="Title: "+e.title),e.headOf&&(t+="\n\nHead of: "+e.headOf),"number"==typeof e.boss){var a=myDiagram.model.findNodeDataForKey(e.boss);null!==a&&(t+="\n\nReporting to: "+a.name)}return t})))),myDiagram.linkTemplate=t(go.Link,go.Link.Orthogonal,{corner:5,selectable:!1},t(go.Shape,{strokeWidth:3,stroke:"#424242"}));myDiagram.model=t(go.TreeModel,{nodeParentKeyProperty:"organParentId",nodeDataArray:e}),myOverview=t(go.Overview,"myOverviewDiv",{observed:myDiagram,contentAlignment:go.Spot.Center})}function searchDiagram(){var e=document.getElementById("mySearch");if(e){if(e.focus(),myDiagram.startTransaction("highlight search"),e.value){var t=new RegExp(e.value,"i"),a=myDiagram.findNodesByExample({name:t},{nation:t},{title:t},{headOf:t});myDiagram.highlightCollection(a),0<a.count&&myDiagram.centerRect(a.first().actualBounds)}else myDiagram.clearHighlighteds();myDiagram.commitTransaction("highlight search")}}appList.reloadOrganData(function(e){for(var t=0;t<e.data.list.length;t++)e.data.list[t].key=e.data.list[t].organId;init(e.data.list)})</script></body></html>