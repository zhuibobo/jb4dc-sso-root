<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><title>JBuild4D</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><script type="text/javascript" src="../../../Js/External/JQuery-3.4.1/jquery-3.4.1.min.js"></script><script type="text/javascript" src="../../../Js/External/VUE-2.6.10/vue.js"></script><script type="text/javascript" src="../../../Js/External/IView-3.X/dist/iview.min.js"></script><script type="text/javascript" src="../../../Js/External/JQuery-UI-1.12.1/jquery-ui.js"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/jquery.ztree.all.js"></script><script type="text/javascript" src="../../../Js/JBuild4DCLib.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/UIEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/VueEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/SSOVueEXComponent.js?refVersion=1"></script><link rel="stylesheet" type="text/css" href="../../../Themes/Default/Css/JBuild4DC.css?refVersion=1"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/IView-3.X/iview.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/JQueryUI/jquery-ui.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/ZTree/zTreeStyle/zTreeStyle.css"><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/jquery.ztree.exhide.js"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/fuzzysearch.js"></script></head><body><div id="appList" class="list-2column"><div class="left-outer-wrap" style="width:250px"><div class="inner-wrap"><div class="tool-bar-wrap"><div alt="新增分类组" title="新增分类组" class="add" @click="addGroup()"></div><div alt="修改分类组" title="修改分类组" class="edit" @click="editGroup"></div><div alt="删除分类组" title="删除分类组" class="del" @click="delGroup"></div><div alt="浏览分类组" title="浏览分类组" class="view" @click="viewGroup"></div><div alt="上移" title="上移" class="order-up" @click="moveGroup('up')"></div><div alt="下移" title="下移" class="order-down last" @click="moveGroup('down')"></div></div><div><ul id="zTreeUL" class="ztree"></ul></div></div></div><div class="right-outer-wrap iv-list-page-wrap" style="padding:10px;left:260px"><div style="width:420px" id="roleList-wraper"><div id="list-button-wrap" class="list-button-outer-wrap"><div class="list-button-inner-wrap"><button-group><i-button type="success" @click="add()">新增</i-button><i-button type="primary" @click="statusEnable('启用')">启用</i-button><i-button type="primary" @click="statusEnable('禁用')">禁用</i-button><i-button type="primary" disabled="disabled">角色权限</i-button><i-button type="primary" disabled="disabled" icon="ios-redo"></i-button><i-button type="primary" @click="move('up')" icon="md-arrow-up"></i-button><i-button type="primary" @click="move('down')" icon="md-arrow-down"></i-button></button-group></div><div style="clear:both"></div></div><i-table :height="roleList.listHeight" stripe border :columns="roleList.columnsConfig" :data="roleList.tableData" class="iv-list-table" :highlight-row="true" @on-selection-change="selectionChange"></i-table><div style="float:right" id="list-pager-wrap"><page @on-change="changePage" :current.sync="roleList.pageNum" :page-size="roleList.pageSize" show-total :total="roleList.pageTotal"></page></div></div><div style="position:absolute;right:10px;top:10px;left:440px;bottom:10px" id="roleMemberList-wraper"><card style="width:100%"><p slot="title"><icon type="md-people"></icon>&nbsp;角色成员<span style="color:#f2b17c">{{getCurrentEditMemberRole()}}</span></p><div slot="extra"><button-group size="small"><i-button type="success" @click="showAddUserToRoleDialog()" icon="md-add"></i-button><i-button type="primary" @click="clearAllRoleMember()" icon="ios-trash"></i-button></button-group></div><i-table :height="roleMemberList.roleMemberListHeight" stripe border :columns="roleMemberList.columnsConfig" :data="roleMemberList.tableData" class="iv-list-table" :highlight-row="true" @on-selection-change="selectionChange"></i-table><div style="text-align:right"><page @on-change="roleMemberChangePage" :current.sync="roleMemberList.pageNum" :page-size="roleMemberList.pageSize" show-total :total="roleMemberList.pageTotal"></page></div></card></div></div><select-department-user-dialog ref="selectDepartmentUserDialog" @on-selected-completed="bindUsersToRole"></select-department-user-dialog></div><script>var appList=new Vue({el:"#appList",mounted:function(){this.initTree(),window.setTimeout(function(){appList.roleList.listHeight=ListPageUtility.GetGeneralPageHeight(-20),appList.roleMemberList.roleMemberListHeight=ListPageUtility.GetGeneralPageHeight(-70)},500),1500<PageStyleUtility.GetPageWidth()&&($("#roleList-wraper").width("800"),$("#roleMemberList-wraper").css("left","820px"),this.roleList.columnsConfig.splice(2,0,{title:"备注",key:"roleName",align:"center"}),500<$("#roleMemberList-wraper").width()&&this.roleMemberList.columnsConfig.splice(1,0,{title:"账号",key:"userAccount",align:"center"}))},data:{acInterface:{getGroupTreeData:"/Rest/SSO/Ro/RoleGroup/GetTreeData",groupEditView:"/HTML/SSO/Role/RoleGroupEdit.html",deleteGroup:"/Rest/SSO/Ro/RoleGroup/Delete",moveGroup:"/Rest/SSO/Ro/RoleGroup/Move",listEditView:"/HTML/SSO/Role/RoleEdit.html",reloadListData:"/Rest/SSO/Ro/Role/GetListData",deleteListRecord:"/Rest/SSO/Ro/Role/Delete",listStatusChange:"/Rest/SSO/Ro/Role/StatusChange",listMove:"/Rest/SSO/Ro/Role/Move",bindUserWithRole:"/Rest/SSO/Ro/UserRoleBind/BindUsersWithRole",reloadUserRoleBindData:"/Rest/SSO/Ro/UserRoleBind/GetBindRoleUsers",deleteUserRoleBind:"/Rest/SSO/Ro/UserRoleBind/DeleteUserRoleBind",clearAllRoleMember:"/Rest/SSO/Ro/UserRoleBind/ClearAllRoleMember"},treeIdFieldName:"roleGroupId",treeObj:null,treeSelectedNode:null,treeSetting:{async:{enable:!0,url:""},data:{key:{name:"roleGroupName"},simpleData:{enable:!0,idKey:"roleGroupId",pIdKey:"roleGroupParentId",rootId:0}},callback:{onClick:function(e,t,i){appList.treeNodeSelected(e,t,i)},onAsyncSuccess:function(e,t,i,l){appList.treeObj.expandAll(!0)}}},roleList:{idFieldName:"roleId",searchCondition:{roleGroupId:{value:"",type:SearchUtility.SearchFieldType.StringType}},columnsConfig:[{type:"selection",width:60,align:"center"},{title:"角色名称",key:"roleName",align:"center"},{title:"操作",key:"roleId",width:140,align:"center",render:function(e,t){return e("div",{class:"list-row-button-wrap"},[ListPageUtility.IViewTableInnerButton.ViewButton(e,t,appList.roleList.idFieldName,appList),ListPageUtility.IViewTableInnerButton.EditButton(e,t,appList.roleList.idFieldName,appList),ListPageUtility.IViewTableInnerButton.DeleteButton(e,t,appList.roleList.idFieldName,appList),ListPageUtility.IViewTableInnerButton.SelectedButton(e,t,appList.idFieldName,appList)])}}],tableData:[],selectionRows:null,pageTotal:0,pageSize:12,pageNum:1,listHeight:ListPageUtility.DefaultListHeight_50(),editMemberRow:null},roleMemberList:{tableData:[],columnsConfig:[{title:"用户名称",key:"userName",align:"center"},{title:"操作",key:"userId",width:80,align:"center",render:function(e,t){return e("div",{class:"list-row-button-wrap"},[e("div",{class:"list-row-button del",on:{click:function(){appList.delUserRoleBind(t)}}})])}}],pageTotal:0,pageSize:12,pageNum:1,searchCondition:{roleId:{value:"",type:SearchUtility.SearchFieldType.StringType}},roleMemberListHeight:ListPageUtility.DefaultListHeight_80()}},methods:{initTree:function(){this.treeSetting.async.url=BaseUtility.BuildAction(this.acInterface.getGroupTreeData,{}),this.treeObj=$.fn.zTree.init($("#zTreeUL"),this.treeSetting)},treeNodeSelected:function(e,t,i){this.treeSelectedNode=i,this.roleList.selectionRows=null,this.roleList.pageNum=1,this.clearSearchCondition(),this.roleList.searchCondition.roleGroupId.value=this.treeSelectedNode[this.treeIdFieldName],this.reloadData()},addGroup:function(){if(null!=this.treeSelectedNode){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"add",parentId:this.treeSelectedNode[appList.treeIdFieldName]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"角色分组"},3)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择父节点!",null)},editGroup:function(){if(null!=this.treeSelectedNode){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"update",recordId:this.treeSelectedNode[appList.treeIdFieldName]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"角色分组"},3)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要编辑的节点!",null)},viewGroup:function(){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"view",recordId:this.treeSelectedNode[appList.treeIdFieldName]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"角色分组"},3)},delGroup:function(){var e=this.treeSelectedNode[this.treeIdFieldName];DialogUtility.Confirm(window,"确认要删除选定的节点吗？",function(){AjaxUtility.Delete(this.acInterface.deleteGroup,{recordId:e},function(e){e.success&&DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){this.treeObj.removeNode(appList.treeSelectedNode),this.treeSelectedNode=null},this)},this)},this)},moveGroup:function(t){if(null!=this.treeSelectedNode){var e=this.treeSelectedNode[appList.treeIdFieldName];AjaxUtility.Post(this.acInterface.moveGroup,{recordId:e,type:t},function(e){e.success&&DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){"down"==t?null!=appList.treeSelectedNode.getNextNode()&&appList.treeObj.moveNode(appList.treeSelectedNode.getNextNode(),appList.treeSelectedNode,"next",!1):null!=appList.treeSelectedNode.getPreNode()&&appList.treeObj.moveNode(appList.treeSelectedNode.getPreNode(),appList.treeSelectedNode,"prev",!1)})},this)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要编辑的节点!",null)},newTreeNode:function(e){appList.treeObj.addNodes(this.treeSelectedNode,e,!1)},updateNode:function(e){this.treeSelectedNode=$.extend(!0,this.treeSelectedNode,e),appList.treeObj.updateNode(this.treeSelectedNode)},clearSearchCondition:function(){for(var e in this.roleList.searchCondition)this.roleList.searchCondition[e].value=""},selectionChange:function(e){this.roleList.selectionRows=e},reloadData:function(){AjaxUtility.Post(this.acInterface.reloadListData,{pageNum:this.roleList.pageNum,pageSize:this.roleList.pageSize,searchCondition:SearchUtility.SerializationSearchCondition(this.roleList.searchCondition),loadDict:!1},function(e){if(e.success){if(this.roleList.tableData=new Array,this.roleList.tableData=e.data.list,this.roleList.pageTotal=e.data.total,null!=this.roleList.selectionRows)for(var t=0;t<this.roleList.tableData.length;t++)for(var i=0;i<this.roleList.selectionRows.length;i++)this.roleList.selectionRows[i][this.roleList.idFieldName]==this.roleList.tableData[t][this.roleList.idFieldName]&&(this.roleList.tableData[t]._checked=!0)}else DialogUtility.AlertError(window,DialogUtility.DialogAlertId,{},e.message,function(){})},this)},add:function(){if(null!=this.treeSelectedNode){var e=BaseUtility.BuildView(this.acInterface.listEditView,{op:"add",groupId:this.treeSelectedNode[appList.treeIdFieldName]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"新增角色"},3)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择分组!",null)},edit:function(e){var t=BaseUtility.BuildView(this.acInterface.listEditView,{op:"update",recordId:e});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"编辑角色"},3)},view:function(e){var t=BaseUtility.BuildView(this.acInterface.listEditView,{op:"view",recordId:e});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"查看角色"},3)},del:function(e){ListPageUtility.IViewTableDeleteRow(this.acInterface.deleteListRecord,e,appList)},statusEnable:function(e){ListPageUtility.IViewChangeServerStatusFace(this.acInterface.listStatusChange,this.roleList.selectionRows,appList.roleList.idFieldName,e,appList)},move:function(e){ListPageUtility.IViewMoveFace(this.acInterface.listMove,this.roleList.selectionRows,appList.roleList.idFieldName,e,appList)},changePage:function(e){this.roleList.pageNum=e,this.reloadData(),this.roleList.selectionRows=null},search:function(){this.roleList.pageNum=1,this.reloadData()},selected:function(e,t){this.roleList.editMemberRow=t.row,this.roleMemberList.pageNum=1,this.roleMemberList.searchCondition.roleId.value=this.roleList.editMemberRow.roleId,this.reloadUserRoleBindData()},reloadUserRoleBindData:function(){AjaxUtility.Post(this.acInterface.reloadUserRoleBindData,{pageNum:this.roleMemberList.pageNum,pageSize:this.roleMemberList.pageSize,roleId:this.roleMemberList.searchCondition.roleId.value},function(e){e.success&&(this.roleMemberList.tableData=new Array,this.roleMemberList.tableData=e.data.list,this.roleMemberList.pageTotal=e.data.total)},this)},roleMemberChangePage:function(e){this.roleMemberList.pageNum=e,this.reloadUserRoleBindData()},getCurrentEditMemberRole:function(){return this.roleList.editMemberRow?"【"+this.roleList.editMemberRow.roleName+"】":""},showAddUserToRoleDialog:function(){this.roleList.editMemberRow?this.$refs.selectDepartmentUserDialog.beginSelect():DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请先选中角色!",null)},bindUsersToRole:function(e){for(var t=new Array,i=0;i<e.length;i++)t.push(e[i].USER_ID);AjaxUtility.Post(this.acInterface.bindUserWithRole,{userIds:t,roleId:this.roleList.editMemberRow.roleId},function(e){e.success&&(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){}),appList.roleMemberList.pageNum=1,appList.reloadUserRoleBindData())},this)},clearAllRoleMember:function(){var t=this;DialogUtility.Confirm(window,"确认要删除全部记录吗？",function(){AjaxUtility.Delete(t.acInterface.clearAllRoleMember,{roleId:t.roleList.editMemberRow.roleId},function(e){e.success&&DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){appList.roleMemberList.pageNum=1,t.reloadUserRoleBindData()})},this)})},delUserRoleBind:function(e){var t=this;DialogUtility.Confirm(window,"确认要删除当前记录吗？",function(){AjaxUtility.Delete(t.acInterface.deleteUserRoleBind,{roleId:t.roleList.editMemberRow.roleId,userId:e.row.userId},function(e){e.success&&DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){t.reloadUserRoleBindData()})},this)})}}})</script></body></html>