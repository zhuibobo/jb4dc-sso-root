<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><title>JBuild4D</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><script type="text/javascript" src="../../../Js/External/JQuery-3.4.1/jquery-3.4.1.min.js"></script><script type="text/javascript" src="../../../Js/External/VUE-2.6.10/vue.js"></script><script type="text/javascript" src="../../../Js/External/IView-3.X/dist/iview.min.js"></script><script type="text/javascript" src="../../../Js/External/JQuery-UI-1.12.1/jquery-ui.js"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/jquery.ztree.all.js"></script><script type="text/javascript" src="../../../Js/JBuild4DCLib.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/UIEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/VueEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/SSOVueEXComponent.js?refVersion=1"></script><link rel="stylesheet" type="text/css" href="../../../Themes/Default/Css/JBuild4DC.css?refVersion=1"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/IView-3.X/iview.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/JQueryUI/jquery-ui.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/JQueryUI/jquery-ui-important.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/ZTree/zTreeStyle/zTreeStyle.css"><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/jquery.ztree.exhide.js"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/fuzzysearch.js"></script></head><body><div id="appForm" class="general-edit-page-wrap" style="margin-top:0" v-cloak><tabs v-model="selectedTabName"><tab-pane label="系统&菜单" name="Menu"><div class="list-2column" style="height:430px"><div class="left-outer-wrap"><div class="inner-wrap" style="width:250px"><div><ul id="zSystemTreeUL" class="ztree"></ul></div></div></div><div class="right-outer-wrap" style="padding:10px;left:260px"><div id="divTreeTable" style="width:98%;margin:auto"><ul id="zMenuTreeUL" class="ztree"></ul></div></div></div></tab-pane><tab-pane label="操作权限" name="Operation"></tab-pane></tabs><div class="button-outer-wrap"><div class="button-inner-wrap"><button-group><i-button type="primary" @click="handleSubmit()" icon="md-checkmark">保存</i-button><i-button @click="handleClose()" icon="md-close">关闭</i-button></button-group></div></div></div><script>var appForm=new Vue({el:"#appForm",mounted:function(){this.initSystemTree()},data:{acInterface:{getSystemTreeData:"/Rest/SSO/App/Application/GetAllMainSsoApp",getMenusDataBySystemId:"/Rest/SSO/Mu/Menu/GetMenusBySystemId",saveOwnerAuth:"/Rest/SSO/Auth/Authority/SaveOwnerAuth"},systemTree:{treeObj:null,treeSelectedNode:null,treeSetting:{view:{dblClickExpand:!1,showLine:!0,fontCss:{color:"black","font-weight":"normal"}},check:{enable:!0,nocheckInherit:!1,radioType:"all"},data:{key:{name:"appName"},simpleData:{enable:!0,idKey:"appId",pIdKey:"appMainId",rootId:0}},callback:{onClick:function(e,t,a){appForm.systemTree.treeSelectedNode=a,appForm.reloadMenuTreeData()},onAsyncSuccess:function(e,t,a,s){appList.treeObj.expandAll(!0)}}}},menuTree:{treeObj:null,treeSelectedNode:null,treeSetting:{view:{dblClickExpand:!1,showLine:!0,fontCss:{color:"black","font-weight":"normal"}},check:{enable:!0,nocheckInherit:!0,radioType:"all",chkboxType:{Y:"s",N:""}},data:{key:{name:"menuName"},simpleData:{enable:!0,idKey:"menuId",pIdKey:"menuParentId",rootId:0}},callback:{onClick:function(e,t,a){appForm.systemTree.treeSelectedNode=a,appForm.reloadMenuTreeData()},onAsyncSuccess:function(e,t,a,s){appList.treeObj.expandAll(!0)}}}},saveAuthData:{systemAuthObjIdList:[],menuAuthObjIdList:[],authOwnerType:"",authOwnerId:"",authObjType:"",systemId:""},selectedTabName:"Menu"},methods:{initSystemTree:function(){AjaxUtility.Post(this.acInterface.getSystemTreeData,{},function(e){if(e.success){for(var t=e.data,a=0;a<t.length;a++)t[a].icon="../../../Themes/Png16X16/computer-link.png";this.systemTree.treeObj=$.fn.zTree.init($("#zSystemTreeUL"),this.systemTree.treeSetting,t),this.systemTree.treeObj.expandAll(!0),this.systemTree.treeObj._host=this}},this)},reloadMenuTreeData:function(){var e=this.systemTree.treeSelectedNode.appId;AjaxUtility.Post(this.acInterface.getMenusDataBySystemId,{systemId:e},function(e){if(e.success){for(var t=e.data,a=0;a<t.length;a++)t[a].icon="../../../Themes/Png16X16/document_letter_okay.png";this.menuTree.treeObj=$.fn.zTree.init($("#zMenuTreeUL"),this.menuTree.treeSetting,t),this.menuTree.treeObj.expandAll(!0),this.menuTree.treeObj._host=this}},this)},resetSaveAuthObjIdList:function(){this.saveAuthData={systemAuthObjIdList:[],menuAuthObjIdList:[],authOwnerType:"",authOwnerId:"",authObjType:"",systemId:""}},handleSubmit:function(){if(this.resetSaveAuthObjIdList(),"Menu"==this.selectedTabName){if(this.saveAuthData.authObjType="Menu",0==this.systemTree.treeObj.getSelectedNodes().length)return;this.saveAuthData.systemId=this.systemTree.treeObj.getSelectedNodes()[0].appId;for(var e=this.systemTree.treeObj.getCheckedNodes(!0),t=this.menuTree.treeObj.getCheckedNodes(!0),a=0;a<e.length;a++){var s=e[a];this.saveAuthData.systemAuthObjIdList.push(s.appId)}for(a=0;a<t.length;a++){var n=t[a];this.saveAuthData.menuAuthObjIdList.push(n.menuId)}}this.saveAuthData.authOwnerType=BaseUtility.GetUrlParaValue("auth_owner_type"),this.saveAuthData.authOwnerId=BaseUtility.GetUrlParaValue("auth_owner_id"),AjaxUtility.Post(this.acInterface.saveOwnerAuth,this.saveAuthData,function(e){e.success&&DialogUtility.AlertText(e.message)},this)},handleClose:function(){DialogUtility.Frame_CloseDialog(window)}}})</script></body></html>