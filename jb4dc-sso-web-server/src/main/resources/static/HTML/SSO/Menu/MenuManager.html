<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><title>JBuild4D</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><script type="text/javascript" src="../../../Js/External/JQuery-3.4.1/jquery-3.4.1.min.js"></script><script type="text/javascript" src="../../../Js/External/VUE-2.6.10/vue.js"></script><script type="text/javascript" src="../../../Js/External/IView-3.X/dist/iview.min.js"></script><script type="text/javascript" src="../../../Js/External/JQuery-UI-1.12.1/jquery-ui.js"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/jquery.ztree.all.js"></script><script type="text/javascript" src="../../../Js/JBuild4DCLib.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/UIEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/VueEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/SSOVueEXComponent.js?refVersion=1"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/jquery.ztree.exhide.js"></script><script type="text/javascript" src="../../../Js/External/ZTree-3.5.40/js/fuzzysearch.js"></script><link rel="stylesheet" type="text/css" href="../../../Themes/Default/Css/JBuild4DC.css?refVersion=1"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/IView-3.X/iview.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/JQueryUI/jquery-ui.css"><link rel="stylesheet" type="text/css" href="../../../Themes/Default/ZTree/zTreeStyle/zTreeStyle.css"></head><body><div id="appList" class="list-2column"><div class="left-outer-wrap"><div class="inner-wrap" style="width:250px"><div class="tool-bar-wrap"></div><div><ul id="zTreeUL" class="ztree"></ul></div></div></div><div class="right-outer-wrap" style="padding:10px;left:260px"><div style="width:100%"><div style="float:right;margin-bottom:15px;margin-top:10px;margin-right:10px"><button-group><i-button type="success" @click="add()" icon="md-add">新增</i-button><i-button type="primary" @click="edit()" icon="md-create">修改</i-button><i-button type="primary" @click="del()" icon="md-close">删除</i-button><i-button type="primary" @click="view()" icon="md-search">浏览</i-button><i-button type="primary" @click="statusEnable('启用')" icon="md-checkmark-circle">启用</i-button><i-button type="primary" @click="statusEnable('禁用')" icon="md-close-circle">禁用</i-button><i-button type="primary" @click="setSelected()" icon="md-checkbox">设为选中</i-button><i-button type="primary" @click="move('up')" icon="md-arrow-up">上移</i-button><i-button type="primary" @click="move('down')" icon="md-arrow-down">下移</i-button></button-group></div></div><div id="divTreeTable" style="width:98%;margin:auto"></div></div></div><script>var treeTableObj=null,appList=new Vue({el:"#appList",mounted:function(){this.initTree()},data:{acInterface:{getGroupTreeData:"/Rest/SystemSetting/Dict/DictionaryGroup/GetTreeData",groupEditView:"/HTML/SystemSetting/Dictionary/DictionaryGroupEdit.html",deleteGroup:"/Rest/SystemSetting/Dict/DictionaryGroup/Delete",dictEditView:"/HTML/SystemSetting/Dictionary/DictionaryEdit.html",getDictData:"/Rest/SystemSetting/Dict/Dictionary/GetListDataByGroupId",deleteDict:"/Rest/SystemSetting/Dict/Dictionary/Delete",statusChange:"/Rest/SystemSetting/Dict/Dictionary/StatusChange",setSelected:"/Rest/SystemSetting/Dict/Dictionary/SetSelected",move:"/Rest/SystemSetting/Dict/Dictionary/Move"},treeObj:null,treeSelectedNode:null,treeSetting:{async:{enable:!0,url:""},data:{key:{name:"dictGroupText"},simpleData:{enable:!0,idKey:"dictGroupId",pIdKey:"dictGroupParentId",rootId:0}},callback:{onClick:function(e,t,i){appList.treeSelectedNode=i,appList.reloadTreeTableData()},onAsyncSuccess:function(e,t,i,l){appList.treeObj.expandAll(!0)}}},treeTableObject:null,treeTableConfig:{CanDeleteWhenHasChild:!1,IdField:"dictId",RowIdPrefix:"TreeTable_",LoadChildJsonURL:"",LoadChildFunc:null,OpenLevel:1,ChildTestField:"dictChildCount",Templates:[{Title:"字典名称",FieldName:"dictText",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"40"},{Title:"字典值",FieldName:"dictValue",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"40",TextAlign:"center"},{Title:"字典状态",FieldName:"dictStatus",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"10%",TextAlign:"center"},{Title:"默认选中",FieldName:"dictIsSelected",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"10%",TextAlign:"center"}],TableClass:"TreeTable",RendererTo:"divTreeTable",TableId:"TreeTable",TableAttrs:{cellpadding:"0",cellspacing:"0",border:"0"}}},methods:{initTree:function(){this.treeSetting.async.url=BaseUtility.BuildAction(this.acInterface.getGroupTreeData,{}),this.treeObj=$.fn.zTree.init($("#zTreeUL"),this.treeSetting)},addGroup:function(){if(null!=this.treeSelectedNode){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"add",parentId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"字典分组"},2)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择父节点!",null)},editGroup:function(){if(null!=this.treeSelectedNode){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"update",recordId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"字典分组"},2)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要编辑的节点!",null)},viewGroup:function(){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"view",recordId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"字典分组"},2)},delGroup:function(){var e=this.treeSelectedNode.dictGroupId,t=this;DialogUtility.Confirm(window,"确认要删除选定的节点吗？",function(){AjaxUtility.Delete(t.acInterface.deleteGroup,{recordId:e},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){this.treeObj.removeNode(appList.treeSelectedNode),this.treeSelectedNode=null},this):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){})},this)})},newTreeNode:function(e,t,i,l){var d={dictGroupId:e,dictGroupValue:t,dictGroupText:i,dictGroupParentId:l};appList.treeObj.addNodes(this.treeSelectedNode,d,!1)},updateNode:function(e,t){this.treeSelectedNode.dictGroupValue=e,this.treeSelectedNode.dictGroupText=t,appList.treeObj.updateNode(this.treeSelectedNode)},reloadTreeTableData:function(){var i=this,l={groupId:this.treeSelectedNode.dictGroupId,groupName:this.treeSelectedNode.dictGroupText};AjaxUtility.Post(this.acInterface.getDictData,l,function(e){if(e.success){null==e.data&&(e.data=new Array),e.data.push({dictId:l.groupId,dictKey:l.groupId,dictValue:l.groupName,dictText:l.groupName,dictStatus:"",dictIsSelected:"",dictCreateTime:""});var t=JsonUtility.ParseArrayJsonToTreeJson({KeyField:"dictId",RelationField:"dictParentId",ChildFieldName:"Nodes"},e.data,l.groupId);$("#divTreeTable").html(""),this.treeTableObject=Object.create(TreeTable),this.treeTableObject.Initialization(i.treeTableConfig),this.treeTableObject.LoadJsonData(t)}},this)},mareSureSelectedTreeTableRow:function(e){if(null==this.treeTableObject)return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请先选定分组!",null),{then:function(e){}};var t=this.treeTableObject.GetSelectedRowData();return null==t?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要"+e+"的字典!",null),{then:function(e){}}):t.dictId==this.treeSelectedNode.dictGroupId?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"不能编辑根节点!",null),{then:function(e){}}):{then:function(e){e.call(appList,t)}}},add:function(){if(null!=this.treeTableObject){var e=this.treeTableObject.GetSelectedRowData();if(null==e)return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择上级字典!",null),!1;var t=BaseUtility.BuildView(this.acInterface.dictEditView,{dictParentId:e.dictId,op:"add",dictGroupId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"字典管理"},2)}},edit:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildView(this.acInterface.dictEditView,{op:"update",recordId:e.dictId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"字典管理"},2)})},del:function(){this.mareSureSelectedTreeTableRow("删除").then(function(e){var t=e.dictId;DialogUtility.Confirm(window,"确认要删除选定的节点吗？",function(){AjaxUtility.Delete(this.acInterface.deleteDict,{recordId:t},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){this.treeTableObject.DeleteRow(t)},this):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)},this)})},view:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildView(this.acInterface.dictEditView,{op:"view",recordId:e.dictId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"字典管理"},2)})},statusEnable:function(i){this.mareSureSelectedTreeTableRow("启用").then(function(t){var e=t.dictId;AjaxUtility.Post(this.acInterface.statusChange,{ids:e,status:i},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){t.dictStatus=i,this.treeTableObject.UpdateToRow(t.dictId,t)},this):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)})},setSelected:function(){this.mareSureSelectedTreeTableRow("选中").then(function(i){var e=i.dictId,l=this;AjaxUtility.Post(this.acInterface.setSelected,{recordId:e},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){for(var e=l.treeTableObject.GetBrothersNodeDatasByParentId(i.dictId),t=0;t<e.length;t++)e[t].dictIsSelected="否",l.treeTableObject.UpdateToRow(e[t].dictId,e[t]);i.dictIsSelected="是",l.treeTableObject.UpdateToRow(i.dictId,i)}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},l)})},move:function(i){this.mareSureSelectedTreeTableRow("选中").then(function(t){var e=t.dictId;AjaxUtility.Post(this.acInterface.move,{recordId:e,type:i},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){"down"==i?this.treeTableObject.MoveDownRow(t.dictId):this.treeTableObject.MoveUpRow(t.dictId)},this):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)})},newTreeTableNode:function(e,t,i,l,d,a,o,r){var n={dictId:e,dictKey:t,dictValue:i,dictText:l,dictGroupId:d,dictCreateTime:a,dictStatus:o,dictIsSelected:r};this.treeTableObject.AppendChildRowToCurrentSelectedRow(n)},updateTreeTableNode:function(e,t,i,l,d,a){var o={dictId:e,dictKey:t,dictValue:i,dictText:l,dictStatus:d,dictIsSelected:a};this.treeTableObject.UpdateToRow(e,o)}}})</script></body></html>